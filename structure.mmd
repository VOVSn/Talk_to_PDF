graph TD
    subgraph "User Interface"
        A[Chainlit UI]
    end

    subgraph "Application Backend (src)"
        B[main.py]

        subgraph "Presentation Layer (presentation)"
            C["factory.py<br/>(@cl.on_chat_start, @cl.on_settings_update)"]
            D["callbacks.py<br/>(@cl.on_message, @cl.action_callback)"]
        end

        subgraph "Core Logic (core)"
            E["agent.py<br/>(setup_agent)"]
            F["rag.py<br/>(setup_rag_chain, get_rag_chain)"]
        end
    end

    subgraph "External Services"
        G["Ollama LLM Service"]
    end

    A -- "WebSocket Interaction" --> C & D

    B -- "Imports & Registers Callbacks" --> C
    B -- "Imports & Registers Factories" --> D

    C -- "Calls" --> E
    C -- "Calls" --> F
    D -- "Calls" --> F

    E -- "HTTP Requests" --> G
    F -- "HTTP Requests" --> G

    style G fill:#f9f,stroke:#333,stroke-width:2px